<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä½›ä¹˜å®—ä¿®è¡ŒåŠŸèª²è¡¨ v1.2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @media print {
            body * { visibility: hidden; }
            #printArea, #printArea * { visibility: visible; }
            #printArea { position: absolute; left: 0; top: 0; width: 100%; border: none; }
            .no-print { display: none !important; }
        }
        table td, table th { border: 1px solid #000; padding: 4px; text-align: center; font-size: 13px; height: 32px; }
        .drawer { transition: transform 0.3s ease-in-out; }
        .drawer-closed { transform: translateY(100%); }
        .cell-input { width: 100%; height: 100%; border: none; outline: none; padding: 0 4px; font-size: 12px; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">

    <div id="mainPage" class="p-6 max-w-md mx-auto relative min-h-screen pb-24">
        <h1 class="text-2xl font-bold text-center mt-8 mb-10 text-indigo-900">ä¿®è¡ŒåŠŸèª²éš¨æ‰‹è¨˜</h1>
        
        <div class="grid grid-cols-2 gap-4">
            <button onclick="openInput('å¿µä½›', 'è²')" class="h-28 bg-orange-500 text-white rounded-2xl shadow-md text-lg font-bold">å¿µä½›</button>
            <button onclick="openInput('æ‰“å', 'åˆ†é˜')" class="h-28 bg-blue-500 text-white rounded-2xl shadow-md text-lg font-bold">æ‰“å</button>
            <button onclick="openInput('æ‹œæ‡º', 'åˆ†é˜')" class="h-28 bg-green-600 text-white rounded-2xl shadow-md text-lg font-bold">æ‹œæ‡º</button>
            <button onclick="openInput('å‹•ç¦ª', 'åˆ†é˜')" class="h-28 bg-purple-500 text-white rounded-2xl shadow-md text-lg font-bold">å‹•ç¦ª</button>
        </div>
        
        <div class="mt-8 p-4 bg-white rounded-xl shadow-sm border border-gray-200">
            <div id="todaySummary" class="grid grid-cols-2 gap-2 text-sm text-gray-500 text-center"></div>
        </div>

        <button onclick="toggleDrawer()" class="fixed bottom-6 right-6 w-14 h-14 bg-indigo-600 text-white rounded-full shadow-lg flex items-center justify-center text-2xl z-40">â˜°</button>
    </div>

    <div id="drawer" class="drawer drawer-closed fixed inset-0 bg-white z-50 overflow-y-auto p-6">
        <div class="flex justify-between items-center mb-6 text-xl font-bold">æ­·å²èˆ‡ç®¡ç† <button onclick="toggleDrawer()" class="text-2xl">âœ•</button></div>
        
        <div id="drawerContent" class="space-y-6">
            <div class="grid grid-cols-2 gap-2">
                <button onclick="showCategory('å¿µä½›')" class="p-3 bg-gray-50 rounded-lg border text-sm">å¿µä½›æ­·å²</button>
                <button onclick="showCategory('æ‰“å')" class="p-3 bg-gray-50 rounded-lg border text-sm">æ‰“åæ­·å²</button>
                <button onclick="showCategory('æ‹œæ‡º')" class="p-3 bg-gray-50 rounded-lg border text-sm">æ‹œæ‡ºæ­·å²</button>
                <button onclick="showCategory('å‹•ç¦ª')" class="p-3 bg-gray-50 rounded-lg border text-sm">å‹•ç¦ªæ­·å²</button>
            </div>

            <button onclick="showArchiveList()" class="w-full py-4 bg-indigo-50 text-indigo-700 rounded-xl font-bold border border-indigo-100">ğŸ” æŸ¥çœ‹å·²å°å­˜å¿ƒå¾—åº«</button>
            
            <button onclick="openReport()" class="w-full py-4 bg-slate-800 text-white rounded-xl font-bold shadow-lg">é–‹å•Ÿ A4 å ±è¡¨</button>

            <div class="pt-20 text-center">
                <p class="text-[10px] text-gray-400 mb-2">å»ºè­°æ¯æœˆ 1 è™ŸåŸ·è¡Œä¸€æ¬¡</p>
                <button onclick="archiveNotes()" class="text-xs text-gray-400 underline italic opacity-50 hover:opacity-100">å°å­˜ä¸¦æ¸…ç©ºæœ¬æœˆå¿ƒå¾—æ¬„ä½</button>
            </div>
        </div>

        <div id="detailContent" class="hidden mt-4">
            <button onclick="backToDrawer()" class="text-indigo-600 mb-4 font-bold">â† è¿”å›</button>
            <h3 id="detailTitle" class="text-lg font-bold mb-2"></h3>
            <ul id="historyList" class="divide-y"></ul>
        </div>
    </div>

    <div id="reportPage" class="hidden fixed inset-0 bg-white z-[60] overflow-y-auto p-2">
        <div class="no-print flex justify-between p-4 bg-gray-100 mb-4 rounded-lg">
            <button onclick="closeReport()" class="px-6 py-2 bg-gray-400 text-white rounded">é—œé–‰</button>
            <button onclick="window.print()" class="px-6 py-2 bg-blue-600 text-white rounded font-bold shadow">åˆ—å° A4 è¡¨æ ¼</button>
        </div>
        
        <div id="printArea" class="bg-white mx-auto p-2" style="max-width: 800px; color:black;">
            <h2 class="text-center text-xl font-bold mb-4">ä½›ä¹˜å®—é–€äººã€å­¸å“¡ä¿®è¡ŒåŠŸèª²</h2>
            <div class="flex justify-between text-[12px] mb-1 px-1">
                <div id="currentYM" class="font-bold">2026å¹´ 01æœˆ</div>
                <div>çµ„åˆ¥ï¼šä¸‰ &nbsp; æ³•è™Ÿï¼š_______ &nbsp; å§“åï¼š_______</div>
            </div>
            <table class="w-full border-collapse border-2 border-black">
                <thead>
                    <tr class="bg-gray-50 text-[11px]">
                        <th rowspan="2" width="5%">æ—¥æœŸ</th><th rowspan="2" width="5%">æ˜ŸæœŸ</th>
                        <th>30000è²</th><th>120åˆ†</th><th>60åˆ†</th><th>60åˆ†</th><th rowspan="2">å¿ƒ å¾—</th>
                    </tr>
                    <tr class="bg-gray-50 text-[11px]">
                        <th>å¿µä½›(è²)</th><th>æ‰“å(åˆ†)</th><th>æ‹œæ‡º(åˆ†)</th><th>å‹•ç¦ª(åˆ†)</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        let db = JSON.parse(localStorage.getItem('practiceDB')) || [];
        let noteDB = JSON.parse(localStorage.getItem('noteDB')) || {};
        let archivedNotes = JSON.parse(localStorage.getItem('archivedNotes')) || [];

        window.onload = () => { renderSummary(); };

        function openInput(cat, unit) {
            const val = prompt(`è«‹è¼¸å…¥ä»Šæ—¥${cat}æ•¸æ“š (${unit}):`);
            if (val && !isNaN(val)) {
                db.push({ id: Date.now(), date: new Date().toISOString().split('T')[0], category: cat, value: parseInt(val) });
                localStorage.setItem('practiceDB', JSON.stringify(db));
                renderSummary();
            }
        }

        function renderSummary() {
            const today = new Date().toISOString().split('T')[0];
            const cats = ['å¿µä½›', 'æ‰“å', 'æ‹œæ‡º', 'å‹•ç¦ª'];
            document.getElementById('todaySummary').innerHTML = cats.map(c => {
                const sum = db.filter(i => i.date === today && i.category === c).reduce((a, b) => a + b.value, 0);
                return `<div>${c}: <span class="font-bold text-indigo-700">${sum}</span></div>`;
            }).join('');
        }

        function toggleDrawer() { document.getElementById('drawer').classList.toggle('drawer-closed'); }
        function openReport() { renderTable(); document.getElementById('reportPage').classList.remove('hidden'); }
        function closeReport() { document.getElementById('reportPage').classList.add('hidden'); }
        function backToDrawer() { document.getElementById('drawerContent').classList.remove('hidden'); document.getElementById('detailContent').classList.add('hidden'); }

        function renderTable() {
            const now = new Date();
            const y = now.getFullYear();
            const m = now.getMonth() + 1;
            document.getElementById('currentYM').innerText = `${y}å¹´ ${String(m).padStart(2, '0')}æœˆ`;
            const days = new Date(y, m, 0).getDate();
            const weekNames = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            let html = "";
            for(let d=1; d<=days; d++) {
                const ds = `${y}-${String(m).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
                const wk = weekNames[new Date(y, m-1, d).getDay()];
                const dayData = db.filter(i => i.date === ds);
                const getSum = (c) => dayData.filter(i => i.category === c).reduce((a, b) => a + b.value, 0) || "";
                
                html += `<tr>
                    <td>${d}</td><td>(${wk})</td>
                    <td>${getSum('å¿µä½›')}</td><td>${getSum('æ‰“å')}</td>
                    <td>${getSum('æ‹œæ‡º')}</td><td>${getSum('å‹•ç¦ª')}</td>
                    <td class="p-0"><input type="text" class="cell-input" value="${noteDB[ds]||''}" oninput="saveNote('${ds}', this.value)"></td>
                </tr>`;
            }
            document.getElementById('tableBody').innerHTML = html;
        }

        function saveNote(date, val) {
            noteDB[date] = val;
            localStorage.setItem('noteDB', JSON.stringify(noteDB));
        }

        function archiveNotes() {
            if(confirm("ç¢ºå®šè¦å°‡æœ¬æœˆå¿ƒå¾—ã€Œå°å­˜ã€é€²æ­·å²åº«ä¸¦æ¸…ç©ºè¡¨æ ¼å—ï¼Ÿ\n(æ­¤å‹•ä½œä¸æœƒåˆªé™¤å¿µä½›ç­‰æ•¸æ“šï¼Œåƒ…æ¸…ç©ºå¿ƒå¾—æ¬„)")) {
                const period = new Date().toISOString().substring(0,7);
                archivedNotes.push({ period: period, data: {...noteDB} });
                localStorage.setItem('archivedNotes', JSON.stringify(archivedNotes));
                noteDB = {}; // æ¸…ç©ºå¿ƒå¾—
                localStorage.setItem('noteDB', JSON.stringify(noteDB));
                alert("å¿ƒå¾—å·²æ”¶ç´è‡³æ­·å²åº«ã€‚");
                renderTable();
            }
        }

        function showCategory(cat) {
            document.getElementById('drawerContent').classList.add('hidden');
            document.getElementById('detailContent').classList.remove('hidden');
            document.getElementById('detailTitle').innerText = cat + "æ­·å²è¨˜éŒ„";
            const list = db.filter(i => i.category === cat).sort((a,b) => b.id - a.id);
            document.getElementById('historyList').innerHTML = list.map(i => `<li class="py-3 flex justify-between text-xs"><span>${i.date}</span><b>${i.value}</b></li>`).join('');
        }
    </script>
</body>
</html>
